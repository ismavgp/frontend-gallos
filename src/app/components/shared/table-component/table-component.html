<div class="table-container">
  @if (loading) {
    <div class="loading-state">
      <mat-icon class="spinner">autorenew</mat-icon>
      <p>Cargando datos...</p>
    </div>
  } @else if (data.length === 0) {
    <div class="empty-state">
      <mat-icon>inbox</mat-icon>
      <p>{{ emptyMessage }}</p>
    </div>
  } @else {
    <div class="table-wrapper">
      <table mat-table [dataSource]="data" class="custom-table" 
             [class.striped]="striped" 
             [class.hoverable]="hoverable">

        @for (column of columns; track column.key) {
          <ng-container [matColumnDef]="column.key">
            <th mat-header-cell *matHeaderCellDef 
                [style.width]="column.width" 
                [style.text-align]="column.align || 'left'">
              {{ column.label }}
            </th>
            <td mat-cell *matCellDef="let row" 
                [style.text-align]="column.align || 'left'"
                [class.badge-cell]="column.type === 'badge'">
              @if (column.type === 'badge') {
                <span class="badge">{{ getCellValue(row, column) }}</span>
              } @else {
                {{ getCellValue(row, column) }}
              }
            </td>
          </ng-container>
        }

        @if (actions.length > 0) {
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-header">
              Acciones
            </th>
            <td mat-cell *matCellDef="let row" class="actions-cell">
              <div class="actions-buttons">
                @for (action of actions; track action.label) {
                  @if (shouldShowAction(action, row)) {
                    <button 
                      mat-icon-button 
                      [color]="action.color || 'primary'"
                      [matTooltip]="action.label"
                      (click)="executeAction(action, row, $event)">
                      <mat-icon>{{ action.icon }}</mat-icon>
                    </button>
                  }
                }
              </div>
            </td>
          </ng-container>
        }

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
            (click)="onRowClick(row)"
            [class.clickable]="rowClick.observed"></tr>
      </table>
    </div>
  }
</div>
