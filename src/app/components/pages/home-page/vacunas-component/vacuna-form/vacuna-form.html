<div class="vacuna-form-container">
  <div class="form-header">
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1 class="form-title">
      <mat-icon class="title-icon">{{ isEditMode() ? 'edit' : 'add' }}</mat-icon>
      {{ isEditMode() ? 'Editar Vacuna' : 'Nueva Vacuna' }}
    </h1>
  </div>

  <form [formGroup]="vacunaForm" (ngSubmit)="onSubmit()" class="vacuna-form">
    
    <div class="form-section">
      <h2 class="section-title">Información de la Vacuna</h2>
      
      <div class="form-fields-grid">
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>Fecha de Vacunación</mat-label>
          <input matInput type="date" formControlName="fecha" required>
          <mat-icon matPrefix>calendar_today</mat-icon>
          @if (vacunaForm.get('fecha')?.hasError('required') && vacunaForm.get('fecha')?.touched) {
            <mat-error>La fecha es requerida</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>Producto/Vacuna</mat-label>
          <input matInput formControlName="producto" placeholder="Ej: Newcastle" required>
          <mat-icon matPrefix>vaccines</mat-icon>
          @if (vacunaForm.get('producto')?.hasError('required') && vacunaForm.get('producto')?.touched) {
            <mat-error>El producto es requerido</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Placa del Gallo</mat-label>
          <input 
            matInput 
            formControlName="id_gallo" 
            placeholder="Buscar por placa o nombre"
            [matAutocomplete]="autoGallo"
            required>
          <mat-icon matPrefix>pets</mat-icon>
          <mat-autocomplete #autoGallo="matAutocomplete" [displayWith]="displayGallo.bind(this)">
            @for (gallo of filteredGallos | async; track gallo.placa) {
              <mat-option [value]="gallo.placa">
                <div class="autocomplete-option">
                  <span class="option-placa">{{ gallo.placa }}</span>
                  <span class="option-nombre">{{ gallo.nombre }}</span>
                </div>
              </mat-option>
            }
          </mat-autocomplete>
          @if (vacunaForm.get('id_gallo')?.hasError('required') && vacunaForm.get('id_gallo')?.touched) {
            <mat-error>La placa del gallo es requerida</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Edad</mat-label>
          <input matInput formControlName="edad" placeholder="Ej: 3 semanas" required>
          <mat-icon matPrefix>event</mat-icon>
          @if (vacunaForm.get('edad')?.hasError('required') && vacunaForm.get('edad')?.touched) {
            <mat-error>La edad es requerida</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>Observaciones</mat-label>
          <textarea 
            matInput 
            formControlName="observaciones" 
            placeholder="Observaciones adicionales..."
            rows="3"></textarea>
          <mat-icon matPrefix>note</mat-icon>
        </mat-form-field>
      </div>
    </div>

    <div class="form-actions">
      <button mat-raised-button type="button" (click)="goBack()" class="cancel-button">
        <mat-icon>cancel</mat-icon>
        Cancelar
      </button>
      <button mat-raised-button color="primary" type="submit" [disabled]="!vacunaForm.valid || isSubmitting()">
        <mat-icon>{{ isEditMode() ? 'save' : 'add' }}</mat-icon>
        {{ isSubmitting() ? 'Guardando...' : (isEditMode() ? 'Guardar' : 'Crear') }}
      </button>
    </div>

  </form>
</div>
